<?xml version="1.0" encoding="UTF-8"?>
<sqlmappingconfig:SqlMappingConfig xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:sqlmappingconfig="http://www.founderfix.com/sqlmappingconfig">
  <dataBaseTableConfig>
  	<!-- 运行实例表 -->
  	<dataBaseTable tableId="fixflow_run_processinstance" tableName="流程实例表" tableValue="FIXFLOW_RUN_PROCESSINSTANCE" />
	<dataBaseTable tableId="fixflow_run_token" tableName="令牌表" tableValue="FIXFLOW_RUN_TOKEN"/>
	<dataBaseTable tableId="fixflow_run_taskinstance" tableName="任务表" tableValue="FIXFLOW_RUN_TASKINSTANCE" />
	<dataBaseTable tableId="fixflow_run_taskidentitylink" tableName="任务候选人表" tableValue="FIXFLOW_RUN_TASKIDENTITYLINK" />
	<dataBaseTable tableId="fixflow_run_variable" tableName="变量表" tableValue="FIXFLOW_RUN_VARIABLE" />
	<!-- 历史实例表 -->
	<dataBaseTable tableId="fixflow_his_processinstance" tableName="流程实例表" tableValue="FIXFLOW_HIS_PROCESSINSTANCE" />
  	<dataBaseTable tableId="fixflow_his_token" tableName="令牌表" tableValue="FIXFLOW_HIS_TOKEN" />
	<dataBaseTable tableId="fixflow_his_taskinstance" tableName="任务表" tableValue="FIXFLOW_HIS_TASKINSTANCE" />
	<dataBaseTable tableId="fixflow_his_taskidentitylink" tableName="务候选人表" tableValue="FIXFLOW_HIS_TASKIDENTITYLINK" />
	<dataBaseTable tableId="fixflow_his_variable" tableName="变量表" tableValue="FIXFLOW_HIS_VARIABLE" />
 	<!-- 发布定义表 -->
 	<dataBaseTable tableId="fixflow_def_deployment" tableName="流程资源部署主表" tableValue="FIXFLOW_DEF_DEPLOYMENT" />
  	<dataBaseTable tableId="fixflow_def_bytearray" tableName="流程资源部署明细表" tableValue="FIXFLOW_DEF_BYTEARRAY" />
	<dataBaseTable tableId="fixflow_def_processdefinition" tableName="流程定义表" tableValue="FIXFLOW_DEF_PROCESSDEFINITION" />
	<!-- 委托授权表 -->
	<dataBaseTable tableId="fixflow_agent_agentinfo" tableName="委托授权主信息表" tableValue="FIXFLOW_AGENT_AGENTINFO" />
  	<dataBaseTable tableId="fixflow_agent_agentdetails" tableName="委托授权明细信息表" tableValue="FIXFLOW_AGENT_AGENTDETAILS" />
	<!-- 邮件表 -->
	<dataBaseTable tableId="fixflow_mail" tableName="邮件信息表" tableValue="FIXFLOW_MAIL" />
  </dataBaseTableConfig>
  <sqlMapping id="history">
  	<sql id="processInstance_insert">
		<![CDATA[
		"insert into fixflow_his_processinstance (PROCESSINSTANCE_ID,PROCESSDEFINITION_ID,SUBJECT,START_TIME,END_TIME,DEFINITION_ID,ROOTTOKEN_ID,BIZ_KEY,INITIATOR,ISSUSPENDED,PROCESSDEFINITION_KEY,PARENT_INSTANCE_ID,PARENT_INSTANCE_TOKEN_ID,UPDATE_TIME,START_AUTHOR,PROCESSLOCATION,ISPIGEONHOLE,INSTANCE_STATUS,ARCHIVE_TIME) "+
		"select PROCESSINSTANCE_ID,PROCESSDEFINITION_ID,SUBJECT,START_TIME,END_TIME,DEFINITION_ID,ROOTTOKEN_ID,BIZ_KEY,INITIATOR,ISSUSPENDED,PROCESSDEFINITION_KEY,PARENT_INSTANCE_ID,PARENT_INSTANCE_TOKEN_ID,UPDATE_TIME,START_AUTHOR,PROCESSLOCATION,ISPIGEONHOLE,INSTANCE_STATUS,"+pagination.getCurrentDateSql()+
		" from fixflow_run_processinstance E where e.processInstance_id in("+whereSql+")"
		]]>
	</sql>
  	<sql id="processInstance_delete"><![CDATA["delete from fixflow_run_processinstance where 1=1 "+processInstanceWhereSql ]]></sql>
  	<sql id="taskInstance_insert">
	  	<![CDATA[
		"insert into FIXFLOW_HIS_TASKINSTANCE (TASKINSTANCE_ID,PROCESSINSTANCE_ID,PROCESSDEFINITION_ID,VERSION,TOKEN_ID,NODE_ID,DESCRIPTION,PARENTTASK_ID,ASSIGNEE,CLAIM_TIME,NAME,CREATE_TIME,START_TIME,ISBLOCKING,END_TIME,DUEDATE,PRIORITY,CATEGORY,OWNER,DELEGATIONSTATESTRING,BIZKEY,COMMAND_TYPE,COMMAND_MESSAGE,TASK_COMMENT,NODE_NAME,PROCESSDEFINITION_KEY,FORMURI,TASKGROUP,TASKTYPE,PROCESSDEFINITION_NAME,ISCANCELLED,ISSUSPENDED,ISOPEN,ISDRAFT,EXPECTED_EXECUTIONTIME,AGENT,ADMIN,FORMURIVIEW,CALLACTIVITY_INSTANCE_ID,COMMAND_ID,PENDINGTASKID,ARCHIVE_TIME)"+
		" select TASKINSTANCE_ID,PROCESSINSTANCE_ID,PROCESSDEFINITION_ID,VERSION,TOKEN_ID,NODE_ID,DESCRIPTION,PARENTTASK_ID,ASSIGNEE,CLAIM_TIME,NAME,CREATE_TIME,START_TIME,ISBLOCKING,END_TIME,DUEDATE,PRIORITY,CATEGORY,OWNER,DELEGATIONSTATESTRING,BIZKEY,COMMAND_TYPE,COMMAND_MESSAGE,TASK_COMMENT,NODE_NAME,PROCESSDEFINITION_KEY,FORMURI,TASKGROUP,TASKTYPE,PROCESSDEFINITION_NAME,ISCANCELLED,ISSUSPENDED,ISOPEN,ISDRAFT,EXPECTED_EXECUTIONTIME,AGENT,ADMIN,FORMURIVIEW,CALLACTIVITY_INSTANCE_ID,COMMAND_ID,PENDINGTASKID,"+pagination.getCurrentDateSql()+
		" from FIXFLOW_RUN_TASKINSTANCE E WHERE E.processinstance_id  in (" + whereSql + ")"
		]]>
	</sql>
  	<sql id="taskInstance_delete"><![CDATA["delete from FIXFLOW_RUN_TASKINSTANCE WHERE  processinstance_id  in ("+ whereSql+")"]]></sql>
  	<sql id="token_insert">
	  	<![CDATA[
	  	"insert into FIXFLOW_HIS_TOKEN (TOKEN_ID,NAME,START_TIME,END_TIME,NODEENTER_TIME,ISABLETOREACTIVATEPARENT,ISSUSPENDED,TOKEN_LOCK,NODE_ID,PROCESSINSTANCE_ID,PARENT_ID,ISSUBPROCESSROOTTOKEN,FREETOKEN,PARENT_FREETOKEN_ID,ARCHIVE_TIME) "+
		"select TOKEN_ID,NAME,START_TIME,END_TIME,NODEENTER_TIME,ISABLETOREACTIVATEPARENT,ISSUSPENDED,TOKEN_LOCK,NODE_ID,PROCESSINSTANCE_ID,PARENT_ID,ISSUBPROCESSROOTTOKEN,FREETOKEN,PARENT_FREETOKEN_ID," + pagination.getCurrentDateSql() +
		" from FIXFLOW_RUN_TOKEN "+
		" E WHERE E.processinstance_id  in (" + whereSql + ")"
	  	]]>
  	</sql>
  	<sql id="token_delete"><![CDATA["delete from FIXFLOW_RUN_TOKEN WHERE processinstance_id  in ("+ whereSql+")"]]></sql>
  	<sql id="identityLink_insert">
	  	<![CDATA[
	  	"insert into FIXFLOW_HIS_TASKIDENTITYLINK (ID,TYPE,USER_ID,GROUP_ID,GROUP_TYPE,TASKINSTANCE_ID,INCLUDE_EXCLUSION,ARCHIVE_TIME)"+
		"select ID,TYPE,USER_ID,GROUP_ID,GROUP_TYPE,TASKINSTANCE_ID,INCLUDE_EXCLUSION, "+pagination.getCurrentDateSql() +
		" from FIXFLOW_RUN_TASKIDENTITYLINK " +
		" E WHERE E.taskinstance_id  in (select taskinstance_id from FIXFLOW_RUN_TASKINSTANCE T WHERE T.PROCESSINSTANCE_ID IN ("+ whereSql + "))"
	  	]]>
  	</sql>
  	<sql id="identityLink_delete"><![CDATA["delete from FIXFLOW_RUN_TASKIDENTITYLINK WHERE  taskinstance_id  in (select taskinstance_id from FIXFLOW_RUN_TASKINSTANCE T WHERE T.PROCESSINSTANCE_ID IN (" + whereSql + "))"]]></sql>
  	<sql id="variable_insert">
	  	<![CDATA[
	  	"insert into FIXFLOW_HIS_VARIABLE(PROCESSINSTANCE_ID,VARIABLE_KEY,VARIABLE_VALUE,VARIABLE_CLASSNAME,TASKINSTANCE_ID,TOKEN_ID,NODE_ID,ARCHIVE_TIME,VARIABLE_TYPE,BIZ_DATA)" +
		"select PROCESSINSTANCE_ID,VARIABLE_KEY,VARIABLE_VALUE,VARIABLE_CLASSNAME,TASKINSTANCE_ID,TOKEN_ID,NODE_ID,"+ pagination.getCurrentDateSql()+",VARIABLE_TYPE,BIZ_DATA" +
		" from FIXFLOW_RUN_VARIABLE " +
		" E WHERE E.processinstance_id  in ("+ whereSql + ")";
	  	]]>
  	</sql>
  	<sql id="variable_delete"><![CDATA["delete from FIXFLOW_RUN_VARIABLE WHERE processinstance_id  in ("+whereSql+")"]]></sql>
  </sqlMapping>
  <sqlMapping id="processInstance">
  	<sql id="findSubProcessInstanceById"><![CDATA["SELECT * FROM FIXFLOW_RUN_PROCESSINSTANCE WHERE PARENT_INSTANCE_ID  = '"+processInstanceId+"' AND END_TIME IS NULL"]]></sql>
  	<sql id="findSubProcessInstanceByIdAndToken"><![CDATA["SELECT * FROM FIXFLOW_RUN_PROCESSINSTANCE WHERE PARENT_INSTANCE_ID  = '"+processInstanceId+"' AND END_TIME IS NULL AND PARENT_INSTANCE_TOKEN_ID='"+tokenId+"'"]]></sql>
  </sqlMapping>
</sqlmappingconfig:SqlMappingConfig>
